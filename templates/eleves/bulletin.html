<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulletin {{ eleve.prenom }} {{ eleve.nom }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @media print { body { -webkit-print-color-adjust: exact; font-size: 10px; } .no-print { display: none; } }
        .header { background: linear-gradient(135deg, #003366, #0055A4); color: white; padding: 20px; border-radius: 12px 12px 0 0; }
        .table th, .table td { padding: 6px !important; text-align: center; vertical-align: middle; font-size: 11px; }
        .moyenne-badge { font-size: 1.1rem; padding: 8px 14px; font-weight: bold; }
        .mention { font-size: 1.8rem; padding: 1.2rem; border-radius: 1.5rem; font-weight: bold; }
        @media (max-width: 768px) { .table { font-size: 9px; } .mention { font-size: 1.4rem; } }
    </style>
</head>
<body class="bg-light">
<div class="container py-3 py-md-5">
    <div class="card shadow-lg border-0">
        <div class="header text-center">
            <h1 class="mb-1">COLLÈGE SAINT JOSEPH DE CUPERTINO JUNIOR</h1>
            <h3 class="mb-0">FICHE DE NOTES • <span id="classe-eleve">...</span> • S1 2025-2026</h3>
        </div>

        <div class="card-body p-3 p-md-5" id="bulletin-body">
            <div class="text-center my-5">
                <div class="spinner-border text-primary" style="width: 4rem; height: 4rem;"></div>
                <h4 class="mt-3">Chargement du bulletin...</h4>
            </div>
        </div>
    </div>
</div>

<!-- Firebase + Affichage automatique des matières selon la classe -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyCEbcDjcCpxIaLT8x1fOUqZX_M-8olJfrw",
  authDomain: "sjcj-site.firebaseapp.com",
  projectId: "sjcj-site",
  storageBucket: "sjcj-site.firebasestorage.app",
  messagingSenderId: "518949071104",
  appId: "1:518949071104:web:a5cf6e80b3a66f6e8f6be5"
 
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const code = window.location.pathname.split('/').pop();

// TOUTES LES MATIÈRES PAR CLASSE (100% correctes)
const MATIERES_PAR_CLASSE = {
    "1ere F4": ["FRANÇAIS","ANGLAIS","MATH","PCT","RDM","PE","DESSIN","SMC","TP","METRE","HYGIENE","PC"],
    "2nde F4": ["FRANÇAIS","ANGLAIS","MATH","PHYSIQUE","DESSIN","INFORMATIQUE","TM/TC","TP","MECANIQUE","PREVENTION","LEGIS"],
    "Tle F4": ["FRANÇAIS","ANGLAIS","MATH","PCT","RDM","PE","DESSIN","METRE","PC","BA","TP","LEGIS"],
    "2nde IMI": ["FRANÇAIS","ANGLAIS","MATH","EB","LA","AS","SEV","SER","ALGO","MATH APPLIQUE","LEGIS"],
    "Tle IMI": ["FRANÇAIS","ANGLAIS","MATH","EB","RESEAU","RP","MATH APPLIQUÉ","LEGIS","BD","PG","ELEC"],
    "Tle F3": ["FRANÇAIS","ANGLAIS","MATH","PHYSIQUE","ELECTRO","EST","PRATIQUE","MEL","DESSIN","ANGLAIS"],
    "2nde FC": ["FRANÇAIS","ANGLAIS","MATH","EPS","PHYSIQUE","HIST-GEO","PHYSIQUE APPLIQUE","AUTOMATISME","DESSIN","ELECTRO DE BASE"],
    "1ere HR": ["FRANÇAIS","ANGLAIS","MATH","TC","SAAH","ECONOMAT","TRB","DROIT","MERCATIQUE","COMPTABILITE"],
    "2nde F3": ["FRANÇAIS","ANGLAIS","MATH","PCT","TECHNO","SCHÉMA","DESSIN","ELECTRO","PRATIQUE","MEL"]
};

db.doc(`eleves/${code}`).get().then(snap => {
    if (!snap.exists) {
        document.getElementById("bulletin-body").innerHTML = "<h3 class='text-danger text-center'>Élève non trouvé</h3>";
        return;
    }
    const eleve = snap.data();
    document.getElementById("classe-eleve").textContent = eleve.classe;

    const matieres = MATIERES_PAR_CLASSE[eleve.classe] || [];

    let rows = '';
    matieres.forEach(m => {
        rows += `<tr>
            <td class="text-start fw-bold">${m}</td>
            <td>—</td><td>—</td><td>—</td><td>—</td>
            <td class="bg-light fw-bold">—</td>
            <td>—</td><td>—</td>
            <td class="bg-light fw-bold">—</td>
            <td><span class="badge bg-secondary">—</span></td>
            <td class="text-start">—</td>
        </tr>`;
    });

    const html = `
        <div class="row mb-4 text-center text-md-start">
            <div class="col-12 col-md-8">
                <h4>Élève : <strong>${eleve.prenom} ${eleve.nom}</strong></h4>
                <p class="mb-0">Code : <strong>${eleve.code_eleve}</strong></p>
            </div>
            <div class="col-12 col-md-4 text-md-end mt-2 mt-md-0">
                <span class="badge bg-danger fs-6">Absences : 0</span>
                <span class="badge bg-warning text-dark fs-6 ms-2">Retards : 0</span>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-bordered table-sm">
                <thead class="table-dark">
                    <tr>
                        <th rowspan="2">Matières</th>
                        <th colspan="4">INTERROGATIONS</th>
                        <th rowspan="2" class="bg-info text-white">Moy.<br>Inter</th>
                        <th colspan="2">DEVOIRS</th>
                        <th rowspan="2" class="bg-warning text-dark">Moy.<br>Devoirs</th>
                        <th rowspan="2" class="bg-success text-white">Moy.<br>Semestre</th>
                        <th rowspan="2">Appréciation</th>
                    </tr>
                    <tr><th>1</th><th>2</th><th>3</th><th>4</th><th>1</th><th>2</th></tr>
                </thead>
                <tbody>
                    ${rows || '<tr><td colspan="11" class="text-center text-muted">Aucune matière définie pour cette classe</td></tr>'}
                </tbody>
            </table>
        </div>

        <div class="text-center mt-5 no-print">
            <div class="btn-group mb-3">
                <a href="?semestre=S1" class="btn btn-outline-primary active">S1</a>
                <a href="?semestre=S2" class="btn btn-outline-primary">S2</a>
            </div>
            <div class="mt-3">
                <a href="/eleves/rechercher/" class="btn btn-secondary btn-lg px-5">Retour</a>
                <button onclick="window.print()" class="btn btn-success btn-lg px-5">PDF / Imprimer</button>
            </div>
        </div>
    `;

    document.getElementById("bulletin-body").innerHTML = html;

}).catch(err => {
    document.getElementById("bulletin-body").innerHTML = "<h3 class='text-danger text-center'>Erreur de chargement</h3>";
});
</script>
</body>
</html>