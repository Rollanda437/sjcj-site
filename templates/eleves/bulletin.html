<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulletin {{ eleve.prenom }} {{ eleve.nom }} - {{ semestre.get_nom_display }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @media print { body { -webkit-print-color-adjust: exact; font-size: 10px; } .no-print { display: none; } }
        .header { background: linear-gradient(135deg, #003366, #0055A4); color: white; padding: 20px; border-radius: 12px 12px 0 0; }
        .table th, .table td { padding: 6px !important; text-align: center; vertical-align: middle; font-size: 11px; }
        .moyenne-badge { font-size: 1.1rem; padding: 8px 14px; font-weight: bold; }
        .mention { font-size: 1.8rem; padding: 1.2rem; border-radius: 1.5rem; font-weight: bold; }
        @media (max-width: 768px) { .table { font-size: 9px; } .mention { font-size: 1.4rem; } }
    </style>
</head>
<body class="bg-light">
<div class="container py-3 py-md-5">
    <div class="card shadow-lg border-0">
        <!-- EN-TÊTE SANS LOGO -->
        <div class="header text-center">
            <h1 class="mb-1">COLLÈGE SAINT JOSEPH DE CUPERTINO JUNIOR</h1>
            <h3 class="mb-0">FICHE DE NOTES • {{ eleve.classe }} • {{ semestre.get_nom_display }} {{ semestre.annee_scolaire }}</h3>
        </div>

        <div class="card-body p-3 p-md-5">
            <div class="row mb-4 text-center text-md-start">
                <div class="col-12 col-md-8">
                    <h4>Élève : <strong>{{ eleve.prenom }} {{ eleve.nom }}</strong></h4>
                    <p class="mb-0">Code : <strong>{{ eleve.code_eleve }}</strong></p>
                </div>
                <div class="col-12 col-md-4 text-md-end mt-2 mt-md-0">
                    <span class="badge bg-danger fs-6">Absences : {{ eleve.nb_absence }}</span>
                    <span class="badge bg-warning text-dark fs-6 ms-2">Retards : {{ eleve.nb_retard }}</span>
                </div>
            </div>

            <!-- TABLEAU OFFICIEL (ordre parfait) -->
            <div class="table-responsive">
                <table class="table table-bordered table-sm">
                    <thead class="table-dark">
                        <tr>
                            <th rowspan="2" class="align-middle">Matières</th>
                            <th colspan="4">INTERROGATIONS</th>
                            <th rowspan="2" class="align-middle bg-info text-white">Moy.<br>Inter</th>
                            <th colspan="2">DEVOIRS</th>
                            <th rowspan="2" class="align-middle bg-warning text-dark">Moy.<br>Devoirs</th>
                            <th rowspan="2" class="align-middle bg-success text-white">Moy.<br>Semestre</th>
                            <th rowspan="2" class="align-middle">Appréciation</th>
                        </tr>
                        <tr>
                            <th>1</th><th>2</th><th>3</th><th>4</th>
                            <th>1</th><th>2</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for note in notes %}
                        <tr>
                            <td class="text-start fw-bold">{{ note.matiere.nom }}</td>
                            <td>{{ note.inter1|floatformat:2|default:"—" }}</td>
                            <td>{{ note.inter2|floatformat:2|default:"—" }}</td>
                            <td>{{ note.inter3|floatformat:2|default:"—" }}</td>
                            <td>{{ note.inter4|floatformat:2|default:"—" }}</td>
                            <td class="fw-bold bg-light">{{ note.moyenne_interrogations|floatformat:2|default:"—" }}</td>
                            <td>{{ note.devoir1|floatformat:2|default:"—" }}</td>
                            <td>{{ note.devoir2|floatformat:2|default:"—" }}</td>
                            <td class="fw-bold bg-light">{{ note.moyenne_devoirs|floatformat:2|default:"—" }}</td>
                            <td>
                                <span class="badge moyenne-badge bg-{% if note.moyenne_semestre >= 16 %}success{% elif note.moyenne_semestre >= 12 %}warning{% elif note.moyenne_semestre >= 10 %}info{% else %}danger{% endif %}">
                                    {{ note.moyenne_semestre|floatformat:2 }}
                                </span>
                            </td>
                            <td class="text-start">{{ note.appreciation|default:"—" }}</td>
                        </tr>
                        {% empty %}
                        <tr><td colspan="11" class="text-center text-muted py-4">Aucune note saisie</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- MOYENNE GÉNÉRALE -->
            {% if moyenne_generale %}
            <div class="text-center mt-5 p-5 bg-gradient border rounded shadow-lg">
                <h2 class="display-5 mb-4">
                    Moyenne générale : <strong class="text-primary display-4">{{ moyenne_generale|floatformat:2 }}/20</strong>
                </h2>
                <div class="mention d-inline-block
                    {% if moyenne_generale >= 16 %}bg-success text-white
                    {% elif moyenne_generale >= 14 %}bg-info text-white
                    {% elif moyenne_generale >= 12 %}bg-warning text-dark
                    {% elif moyenne_generale >= 10 %}bg-secondary text-white
                    {% else %}bg-danger text-white{% endif %}">
                    {% if moyenne_generale >= 16 %}FÉLICITATIONS
                    {% elif moyenne_generale >= 14 %}TRÈS BIEN
                    {% elif moyenne_generale >= 12 %}BIEN
                    {% elif moyenne_generale >= 10 %}ASSEZ BIEN
                    {% else %}À AMÉLIORER{% endif %}
                </div>
            </div>
            {% endif %}

            <!-- BOUTONS -->
            <div class="text-center mt-5 no-print">
                <div class="btn-group mb-3 flex-wrap" role="group">
                    <a href="?semestre=S1" class="btn btn-outline-primary {% if semestre.nom == 'S1' %}active{% endif %}">S1</a>
                    <a href="?semestre=S2" class="btn btn-outline-primary {% if semestre.nom == 'S2' %}active{% endif %}">S2</a>
                </div>
                <div class="mt-3">
                    <a href="/eleves/rechercher/" class="btn btn-secondary btn-lg px-5">Retour</a>
                    <button onclick="window.print()" class="btn btn-success btn-lg px-5">PDF / Imprimer</button>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>